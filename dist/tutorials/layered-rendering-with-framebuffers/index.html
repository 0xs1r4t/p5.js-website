<!DOCTYPE html><html><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><link href=/_astro/_slug_.C79K3bky.css rel=stylesheet /></head><body><nav><ul><a href=/ >Home</a> <a href=/reference>Reference</a> <a href=/tutorials>Tutorials</a> <a href=/examples>Examples</a> <a href=/community>Community</a> <a href=/about>About</a> <a href=/contribute>Contribute</a></ul></nav><div class="flex space-x-2"><select id=locale-select><option value=/tutorials/layered-rendering-with-framebuffers/ selected=true>English</option><option value=/ar/tutorials/layered-rendering-with-framebuffers/ >العربية</option><option value=/es/tutorials/layered-rendering-with-framebuffers/ >español</option><option value=/hi/tutorials/layered-rendering-with-framebuffers/ >हिन्दी</option><option value=/ko/tutorials/layered-rendering-with-framebuffers/ >한국어</option><option value=/pt-br/tutorials/layered-rendering-with-framebuffers/ >português (Brasil)</option><option value=/sk/tutorials/layered-rendering-with-framebuffers/ >slovenčina</option><option value=/zh/tutorials/layered-rendering-with-framebuffers/ >中文</option></select><script>document.getElementById("locale-select")?.addEventListener("change",(function(){window.location.href=this.value}))</script><div><form action=/search method=GET role=search><label for=search-term>Search</label> <input aria-label="Search through site content" class="border border-black" id=search-term name=term required type=search> <button type=submit>Search</button></form></div><div>Language: en</div><div>Accessibility</div></div><h1 class="font-bold text-lg">Layered Rendering with Framebuffers</h1><span></span><main><h6>By Dave Pagurek, Adam Ferriss</h6><p>Sometimes in a sketch, you might want to draw to an image instead of directly to the screen. This allows you to use the image as a texture on 3D shapes, achieve complex rendering effects, efficiently repeat the image multiple times, and more.</p><p>In 2D mode, you can use a <code>p5.Graphics</code> to achieve this. While they also work in WebGL mode, you can use a <code>p5.Framebuffer</code> for better performance and flexibility.</p><h2 id=what-makes-framebuffers-special>What makes Framebuffers special?</h2><p>Framebuffers live on your computer’s GPU (Graphics Processing Unit), the part of your computer that specializes in drawing pixels of images as fast as possible in parallel. The JavaScript you write for your sketch runs on your computer’s CPU (Central Processing Unit) and does only one thing at a time. Because Framebuffers live on the GPU, where we’re already doing most of the computation, you can write to and read from Framebuffers quickly without your computer having to move lots of data around between the CPU and GPU!</p><p>Framebuffers can also contain more information than a typical image or canvas. You can use higher-precision floating point numbers to store colors more accurately without running into weird visuals from rounding errors. They can also store 3D depth information about the contents drawn in them, which can help you create visual effects like depth of field and shadows.</p><table><tr><td><p><img alt="Three renderings of a line of spheres going off into the distance. The first shows them in focus and in color. The second shows them monochrome, getting more white as they go into the distance. The final one is in color, with spheres getting more blurred as they go into the distance." decoding=async height=400 loading=lazy src=/_astro/fbo-channels.D_sLgSN7_Z1261fD.webp width=1600></p></td></tr><tr><td><p>Framebuffer color</p></td><td><p>Framebuffer depth</p></td><td><p>Final image with focal blur using color + depth</p></td></tr></table><h2 id=using-a-p5framebuffer>Using a <code>p5.Framebuffer</code></h2><p>A <code>p5.Framebuffer</code> is a surface you can draw to, similar to the main canvas. Drawing to the main canvas is like drawing on a sheet of paper. When you call <code>begin()</code> on a <code>p5.Framebuffer</code>, it’s like laying a fresh sheet of paper on top of the original, which will collect any new things that get drawn. Calling <code>end()</code> on a <code>p5.Framebuffer</code> will remove that sheet again so that subsequent drawing will go right to the main canvas again.</p><p>You can create a <code>p5.Framebuffer</code> with the <code>createFramebuffer()</code> function. You can optionally pass an object in as a parameter to specify a width and height.By default, <code>p5.Framebuffer</code>s are the same size as the main canvas. There are other options you can add to this object to control how color and depth information is stored, which we’ll get into later. Check out <a href=/reference/en/p5/createFramebuffer>the <code>createFramebuffer()</code> documentation</a> for the full reference.</p><p>You may already be familiar with drawing to <code>p5.Graphics</code> objects. Here’s a comparison of some code using <code>p5.Graphics</code> as a texture, and what the equivalent <code>p5.Framebuffer</code> code looks like:</p><div class="flex flex-row items-start justify-start"><div class=flex-1><h4 id=using-p5graphics>Using <code>p5.Graphics</code></h4><pre class="github-dark astro-code" style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#f97583>let</span><span style=color:#e1e4e8> layer;</span></span>
<span class=line><span style=color:#f97583>function</span><span style=color:#b392f0> setup</span><span style=color:#e1e4e8>() {</span></span>
<span class=line><span style=color:#b392f0>  createCanvas</span><span style=color:#e1e4e8>(</span><span style=color:#79b8ff>200</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>200</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>WEBGL</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#e1e4e8>  layer </span><span style=color:#f97583>=</span><span style=color:#b392f0> createGraphics</span><span style=color:#e1e4e8>(</span><span style=color:#79b8ff>200</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>200</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#b392f0>  describe</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>&#39;a rotating red cube with yellow dots on each face&#39;</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#e1e4e8>}</span></span>
<span class=line><span style=color:#f97583>function</span><span style=color:#b392f0> draw</span><span style=color:#e1e4e8>() {</span></span>
<span class=line><span style=color:#f97583>  let</span><span style=color:#e1e4e8> t </span><span style=color:#f97583>=</span><span style=color:#b392f0> millis</span><span style=color:#e1e4e8>() </span><span style=color:#f97583>*</span><span style=color:#79b8ff> 0.001</span><span style=color:#e1e4e8>;</span></span>
<span class=line><span style=color:#e1e4e8>  layer.</span><span style=color:#b392f0>background</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>&#39;red&#39;</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#e1e4e8>  layer.</span><span style=color:#b392f0>noStroke</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#e1e4e8>  layer.</span><span style=color:#b392f0>fill</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>&#39;yellow&#39;</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#f97583>  for</span><span style=color:#e1e4e8> (</span><span style=color:#f97583>let</span><span style=color:#e1e4e8> i </span><span style=color:#f97583>=</span><span style=color:#79b8ff> 0</span><span style=color:#e1e4e8>; i </span><span style=color:#f97583>&lt;</span><span style=color:#79b8ff> 30</span><span style=color:#e1e4e8>; i </span><span style=color:#f97583>+=</span><span style=color:#79b8ff> 1</span><span style=color:#e1e4e8>) {</span></span>
<span class=line><span style=color:#e1e4e8>    layer.</span><span style=color:#b392f0>circle</span><span style=color:#e1e4e8>(</span></span>
<span class=line><span style=color:#b392f0>      map</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>noise</span><span style=color:#e1e4e8>(i</span><span style=color:#f97583>*</span><span style=color:#79b8ff>10</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>0</span><span style=color:#e1e4e8>, t), </span><span style=color:#79b8ff>0</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>1</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>0</span><span style=color:#e1e4e8>, width),</span></span>
<span class=line><span style=color:#b392f0>      map</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>noise</span><span style=color:#e1e4e8>(i</span><span style=color:#f97583>*</span><span style=color:#79b8ff>10</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>100</span><span style=color:#e1e4e8>, t), </span><span style=color:#79b8ff>0</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>1</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>0</span><span style=color:#e1e4e8>, height),</span></span>
<span class=line><span style=color:#79b8ff>      20</span></span>
<span class=line><span style=color:#e1e4e8>    );</span></span>
<span class=line><span style=color:#e1e4e8>  }</span></span>
<span class=line><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>  background</span><span style=color:#e1e4e8>(</span><span style=color:#79b8ff>255</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#b392f0>  lights</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#b392f0>  noStroke</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#b392f0>  texture</span><span style=color:#e1e4e8>(layer);</span></span>
<span class=line><span style=color:#b392f0>  rotateX</span><span style=color:#e1e4e8>(t);</span></span>
<span class=line><span style=color:#b392f0>  rotateY</span><span style=color:#e1e4e8>(t);</span></span>
<span class=line><span style=color:#b392f0>  box</span><span style=color:#e1e4e8>(</span><span style=color:#79b8ff>100</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#e1e4e8>}</span></span></code></pre></div><div class=flex-1><h4 id=using-p5framebuffer>Using <code>p5.Framebuffer</code></h4><pre class="github-dark astro-code" style=background-color:#24292e;color:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#f97583>let</span><span style=color:#e1e4e8> layer;</span></span>
<span class=line><span style=color:#f97583>function</span><span style=color:#b392f0> setup</span><span style=color:#e1e4e8>() {</span></span>
<span class=line><span style=color:#b392f0>  createCanvas</span><span style=color:#e1e4e8>(</span><span style=color:#79b8ff>200</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>200</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>WEBGL</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#e1e4e8>  layer </span><span style=color:#f97583>=</span><span style=color:#b392f0> createFramebuffer</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#b392f0>  describe</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>&#39;a rotating red cube with yellow dots on each face&#39;</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#e1e4e8>}</span></span>
<span class=line><span style=color:#f97583>function</span><span style=color:#b392f0> draw</span><span style=color:#e1e4e8>() {</span></span>
<span class=line><span style=color:#f97583>  let</span><span style=color:#e1e4e8> t </span><span style=color:#f97583>=</span><span style=color:#b392f0> millis</span><span style=color:#e1e4e8>() </span><span style=color:#f97583>*</span><span style=color:#79b8ff> 0.001</span><span style=color:#e1e4e8>;</span></span>
<span class=line><span style=color:#e1e4e8>  layer.</span><span style=color:#b392f0>begin</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#b392f0>  background</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>&#39;red&#39;</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#b392f0>  noStroke</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#b392f0>  fill</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>&#39;yellow&#39;</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#f97583>  for</span><span style=color:#e1e4e8> (</span><span style=color:#f97583>let</span><span style=color:#e1e4e8> i </span><span style=color:#f97583>=</span><span style=color:#79b8ff> 0</span><span style=color:#e1e4e8>; i </span><span style=color:#f97583>&lt;</span><span style=color:#79b8ff> 30</span><span style=color:#e1e4e8>; i </span><span style=color:#f97583>+=</span><span style=color:#79b8ff> 1</span><span style=color:#e1e4e8>) {</span></span>
<span class=line><span style=color:#b392f0>    circle</span><span style=color:#e1e4e8>(</span></span>
<span class=line><span style=color:#b392f0>      map</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>noise</span><span style=color:#e1e4e8>(i</span><span style=color:#f97583>*</span><span style=color:#79b8ff>10</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>0</span><span style=color:#e1e4e8>, t), </span><span style=color:#79b8ff>0</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>1</span><span style=color:#e1e4e8>, </span><span style=color:#f97583>-</span><span style=color:#e1e4e8>width</span><span style=color:#f97583>/</span><span style=color:#79b8ff>2</span><span style=color:#e1e4e8>, width</span><span style=color:#f97583>/</span><span style=color:#79b8ff>2</span><span style=color:#e1e4e8>),</span></span>
<span class=line><span style=color:#b392f0>      map</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>noise</span><span style=color:#e1e4e8>(i</span><span style=color:#f97583>*</span><span style=color:#79b8ff>10</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>100</span><span style=color:#e1e4e8>, t), </span><span style=color:#79b8ff>0</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>1</span><span style=color:#e1e4e8>, </span><span style=color:#f97583>-</span><span style=color:#e1e4e8>height</span><span style=color:#f97583>/</span><span style=color:#79b8ff>2</span><span style=color:#e1e4e8>, height</span><span style=color:#f97583>/</span><span style=color:#79b8ff>2</span><span style=color:#e1e4e8>),</span></span>
<span class=line><span style=color:#79b8ff>      20</span></span>
<span class=line><span style=color:#e1e4e8>    );</span></span>
<span class=line><span style=color:#e1e4e8>  }</span></span>
<span class=line><span style=color:#e1e4e8>  layer.</span><span style=color:#b392f0>end</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#e1e4e8> </span></span>
<span class=line><span style=color:#b392f0>  background</span><span style=color:#e1e4e8>(</span><span style=color:#79b8ff>255</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#b392f0>  lights</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#b392f0>  noStroke</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#b392f0>  texture</span><span style=color:#e1e4e8>(layer);</span></span>
<span class=line><span style=color:#b392f0>  rotateX</span><span style=color:#e1e4e8>(t);</span></span>
<span class=line><span style=color:#b392f0>  rotateY</span><span style=color:#e1e4e8>(t);</span></span>
<span class=line><span style=color:#b392f0>  box</span><span style=color:#e1e4e8>(</span><span style=color:#79b8ff>100</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#e1e4e8>}</span></span></code></pre></div><div class=flex-1><h4 id=result>Result</h4><iframe aria-label="Code Preview" height=200 sandbox="allow-scripts allow-popups allow-modals allow-forms" srcdoc="&lt;!DOCTYPE html>
&lt;meta charset=&quot;utf8&quot; />
&lt;style type='text/css'>
html, body {
  margin: 0;
  padding: 0;
}
canvas {
  display: block;
}

&lt;/style>
&lt;body>&lt;/body>
&lt;script id=&quot;code&quot; type=&quot;text/javascript&quot;>
let layer;
function setup() {
  createCanvas(200, 200, WEBGL);
  layer = createFramebuffer();
  describe('a rotating red cube with yellow dots on each face');
}
function draw() {
  let t = millis() * 0.001;
  layer.begin();
  background('red');
  noStroke();
  fill('yellow');
  for (let i = 0; i &lt; 30; i += 1) {
    circle(
      map(noise(i*10, 0, t), 0, 1, -width/2, width/2),
      map(noise(i*10, 100, t), 0, 1, -height/2, height/2),
      20
    );
  }
  layer.end();
 
  background(255);
  lights();
  noStroke();
  texture(layer);
  rotateX(t);
  rotateY(t);
  box(100);
}
&lt;/script>
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.1/p5.min.js&quot;>&lt;/script>
" title="Code Preview" width=200></iframe></div></div><p>By default, <code>p5.Framebuffer</code>s are not drawn to the screen. The main canvas is the only thing shown at the end of <code>draw()</code>. To make the contents of a <code>p5.Framebuffer</code> visible, it has to be stamped upon the main canvas. This is typically done with a call to <code>image(yourFramebuffer, x, y, width, height)</code>. Similar to the main canvas, a <code>p5.Framebuffer</code> only gets cleared when you ask it to be cleared, so you can stamp it on the main canvas as many times as you want, like in the example below.</p><table class=h-1><tbody><tr class="[&>*:not(:first-child)]:max-w-xl [&>*:not(:first-child)]:py-2 [&>*]:align-top [&>*]:m-0"><td class=align-top style=height:100%;margin:0><pre class="github-dark shiki" style=background-color:#24292e;color:#e1e4e8;height:100% tabindex=0><code><span class=line></span></code></pre></td><th></th><th><p>Main canvas</p></th><th><p><code>layer</code></p></th></tr><tr class="[&>*:not(:first-child)]:max-w-xl [&>*:not(:first-child)]:py-2 [&>*]:align-top [&>*]:m-0"><td class=align-top style=height:100%;margin:0><pre class="github-dark shiki" style=background-color:#24292e;color:#e1e4e8;height:100% tabindex=0><code><span class=line><span style=color:#f97583>let</span><span style=color:#e1e4e8> layer;</span></span>
<span class=line><span style=color:#f97583>function</span><span style=color:#b392f0> setup</span><span style=color:#e1e4e8>() {</span></span>
<span class=line><span style=color:#b392f0>&nbsp; createCanvas</span><span style=color:#e1e4e8>(windowWidth, windowHeight, </span><span style=color:#79b8ff>WEBGL</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#e1e4e8>&nbsp; layer </span><span style=color:#f97583>=</span><span style=color:#b392f0> createFramebuffer</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#e1e4e8>}</span></span>
<span class=line><span style=color:#f97583>function</span><span style=color:#b392f0> draw</span><span style=color:#e1e4e8>() {</span></span></code></pre></td><td><p>Initially, anything that gets drawn goes to the main canvas. On the right, we’ve indicated the surface that is currently being drawn to by outlining it in red.</p></td><td><table height=100 style="border:2px solid red;border-collapse:separate;margin:5px" width=100></table></td><td><table height=100 style="border:2px solid gray;border-collapse:separate;margin:5px" width=100></table></td></tr><tr class="[&>*:not(:first-child)]:max-w-xl [&>*:not(:first-child)]:py-2 [&>*]:align-top [&>*]:m-0"><td class=align-top style=height:100%;margin:0><pre class="github-dark shiki" style=background-color:#24292e;color:#e1e4e8;height:100% tabindex=0><code><span class=line><span style=color:#6a737d>&nbsp; // Start drawing to the framebuffer</span></span>
<span class=line><span style=color:#e1e4e8>&nbsp; layer.</span><span style=color:#b392f0>begin</span><span style=color:#e1e4e8>();</span></span></code></pre></td><td><p>By calling <code>begin()</code> on a <code>p5.Framebuffer</code>, everything drawn after this will go to that layer instead of to the main canvas.</p></td><td><table height=100 style="border:2px solid gray;border-collapse:separate;margin:5px" width=100></table></td><td><table height=100 style="border:2px solid red;border-collapse:separate;margin:5px" width=100></table></td></tr><tr class="[&>*:not(:first-child)]:max-w-xl [&>*:not(:first-child)]:py-2 [&>*]:align-top [&>*]:m-0"><td class=align-top style=height:100%;margin:0><pre class="github-dark shiki" style=background-color:#24292e;color:#e1e4e8;height:100% tabindex=0><code><span class=line><span style=color:#b392f0>&nbsp; clear</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#e1e4e8>&nbsp;</span></span>
<span class=line><span style=color:#b392f0>&nbsp; lights</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#b392f0>&nbsp; noStroke</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#b392f0>&nbsp; rotateX</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>millis</span><span style=color:#e1e4e8>() </span><span style=color:#f97583>*</span><span style=color:#79b8ff> 0.001</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#b392f0>&nbsp; rotateY</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>millis</span><span style=color:#e1e4e8>() </span><span style=color:#f97583>*</span><span style=color:#79b8ff> 0.001</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#b392f0>&nbsp; box</span><span style=color:#e1e4e8>(</span><span style=color:#b392f0>min</span><span style=color:#e1e4e8>(width</span><span style=color:#f97583>/</span><span style=color:#79b8ff>2</span><span style=color:#e1e4e8>, height</span><span style=color:#f97583>/</span><span style=color:#79b8ff>2</span><span style=color:#e1e4e8>));</span></span></code></pre></td><td><p>This clears the <code>p5.Framebuffer</code> and draws a cube. After this, the main canvas is still blank, but the <code>p5.Framebuffer</code> has a cube in it.</p></td><td><table height=100 style="border:2px solid gray;border-collapse:separate;margin:5px" width=100></table></td><td><table height=100 style="border:2px solid red;border-collapse:separate;margin:5px" width=100><td><img alt="A cube filling the canvas" decoding=async height=100 loading=lazy src=/_astro/cube.CWtqdkfq_1EE85X.webp width=100></td></table></td></tr><tr class="[&>*:not(:first-child)]:max-w-xl [&>*:not(:first-child)]:py-2 [&>*]:align-top [&>*]:m-0"><td class=align-top style=height:100%;margin:0><pre class="github-dark shiki" style=background-color:#24292e;color:#e1e4e8;height:100% tabindex=0><code><span class=line><span style=color:#6a737d>&nbsp; // Stop drawing to the framebuffer</span></span>
<span class=line><span style=color:#e1e4e8>&nbsp; layer.</span><span style=color:#b392f0>end</span><span style=color:#e1e4e8>();</span></span></code></pre></td><td><p>By calling <code>end()</code> on the <code>p5.Framebuffer</code>, everything drawn after this will go to the main canvas.</p></td><td><table height=100 style="border:2px solid red;border-collapse:separate;margin:5px" width=100></table></td><td><table height=100 style="border:2px solid gray;border-collapse:separate;margin:5px" width=100><td><img alt="A cube filling the canvas" decoding=async height=100 loading=lazy src=/_astro/cube.CWtqdkfq_1EE85X.webp width=100></td></table></td></tr><tr class="[&>*:not(:first-child)]:max-w-xl [&>*:not(:first-child)]:py-2 [&>*]:align-top [&>*]:m-0"><td class=align-top style=height:100%;margin:0><pre class="github-dark shiki" style=background-color:#24292e;color:#e1e4e8;height:100% tabindex=0><code><span class=line><span style=color:#6a737d>&nbsp; // Draw the layer to the main canvas</span></span>
<span class=line><span style=color:#b392f0>&nbsp; clear</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#b392f0>&nbsp; translate</span><span style=color:#e1e4e8>(</span><span style=color:#f97583>-</span><span style=color:#e1e4e8>width</span><span style=color:#f97583>/</span><span style=color:#79b8ff>2</span><span style=color:#e1e4e8>, </span><span style=color:#f97583>-</span><span style=color:#e1e4e8>height</span><span style=color:#f97583>/</span><span style=color:#79b8ff>2</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#f97583>&nbsp; for</span><span style=color:#e1e4e8> (</span><span style=color:#f97583>let</span><span style=color:#e1e4e8> x </span><span style=color:#f97583>=</span><span style=color:#79b8ff> 0</span><span style=color:#e1e4e8>; x </span><span style=color:#f97583>&lt;</span><span style=color:#79b8ff> 4</span><span style=color:#e1e4e8>; x </span><span style=color:#f97583>+=</span><span style=color:#79b8ff> 1</span><span style=color:#e1e4e8>) {</span></span>
<span class=line><span style=color:#f97583>&nbsp; &nbsp; for</span><span style=color:#e1e4e8> (</span><span style=color:#f97583>let</span><span style=color:#e1e4e8> y </span><span style=color:#f97583>=</span><span style=color:#79b8ff> 0</span><span style=color:#e1e4e8>; y </span><span style=color:#f97583>&lt;</span><span style=color:#79b8ff> 4</span><span style=color:#e1e4e8>; y </span><span style=color:#f97583>+=</span><span style=color:#79b8ff> 1</span><span style=color:#e1e4e8>) {</span></span>
<span class=line><span style=color:#b392f0>&nbsp; &nbsp; &nbsp; image</span><span style=color:#e1e4e8>(</span></span>
<span class=line><span style=color:#e1e4e8>&nbsp; &nbsp; &nbsp; &nbsp; layer,</span></span>
<span class=line><span style=color:#e1e4e8>&nbsp; &nbsp; &nbsp; &nbsp; x</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>width</span><span style=color:#f97583>/</span><span style=color:#79b8ff>4</span><span style=color:#e1e4e8>, y</span><span style=color:#f97583>*</span><span style=color:#e1e4e8>height</span><span style=color:#f97583>/</span><span style=color:#79b8ff>4</span><span style=color:#e1e4e8>,</span></span>
<span class=line><span style=color:#e1e4e8>&nbsp; &nbsp; &nbsp; &nbsp; width</span><span style=color:#f97583>/</span><span style=color:#79b8ff>4</span><span style=color:#e1e4e8>, height</span><span style=color:#f97583>/</span><span style=color:#79b8ff>4</span></span>
<span class=line><span style=color:#e1e4e8>&nbsp; &nbsp; &nbsp; );</span></span>
<span class=line><span style=color:#e1e4e8>&nbsp; &nbsp; }</span></span>
<span class=line><span style=color:#e1e4e8>&nbsp; }</span></span>
<span class=line><span style=color:#e1e4e8>}</span></span></code></pre></td><td><p>This draws a 4-by-4 grid on the main canvas, drawing a copy of the <code>layer</code> <code>p5.Framebuffer</code> for each cell.</p></td><td><table height=100 style="border:2px solid red;border-collapse:separate;margin:5px" width=100><td><img alt="An image of a cube, repeated in a four-by-four grid that fills the canvas" decoding=async height=97 loading=lazy src=/_astro/cube-grid.RaVxEpVr_2b54vt.webp width=100></td></table></td><td><table height=100 style="border:2px solid gray;border-collapse:separate;margin:5px" width=100><td><img alt="A cube filling the canvas" decoding=async height=100 loading=lazy src=/_astro/cube.CWtqdkfq_1EE85X.webp width=100></td></table></td></tr><tr class="[&>*:not(:first-child)]:max-w-xl [&>*:not(:first-child)]:py-2 [&>*]:align-top [&>*]:m-0"><td class=align-top style=height:100%;margin:0><pre class="github-dark shiki" style=background-color:#24292e;color:#e1e4e8;height:100% tabindex=0><code><span class=line></span></code></pre></td></tr></tbody></table><div class=callout><h5>Try this!</h5><p>Can you simulate the vision of a fly by drawing a <code>p5.Framebuffer</code> many times in a honeycomb pattern?</p></div><h2 id=sketching-with-feedback>Sketching with Feedback</h2><p><a href=https://en.wikipedia.org/wiki/Video_feedback>Video feedback</a> is a technique where the previous frame of a video gets used when drawing the next frame. This can be used to produce visuals that look like they trail off to infinity. The effect looks similar to when you stand between two mirrors.</p><p>To use feedback in a sketch, you typically draw to a <code>p5.Framebuffer</code> layer, so you have an image of the current frame. Then, when drawing to the next frame, you can add the previous frame to your drawing by using the image of the previous frame.</p><p>The fastest way to do this is to keep <strong>two layers</strong> around, one for the previous frame and one for the next frame. At the start of <code>draw()</code>, swap the two layers: what used to be the next frame is now the previous frame, and you are free to clear the next frame and draw a new image to it. In computer graphics, this technique is called “ping-ponging.”</p><style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(self.Astro||(self.Astro={})).load=async t=>{await(await t())()},window.dispatchEvent(new Event("astro:load")),(()=>{var t,e=Object.defineProperty,r=(t,r,n)=>(((t,r,n)=>{r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n})(t,"symbol"!=typeof r?r+"":r,n),n);{let e={0:t=>i(t),1:t=>s(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(s(t)),5:t=>new Set(s(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t)},n=t=>{let[r,n]=t;return r in e?e[r](n):void 0},s=t=>t.map(n),i=t=>"object"!=typeof t||null===t?t:Object.fromEntries(Object.entries(t).map((([t,e])=>[t,n(e)])));customElements.get("astro-island")||customElements.define("astro-island",(t=class extends HTMLElement{constructor(){super(...arguments),r(this,"Component"),r(this,"hydrator"),r(this,"hydrate",(async()=>{var t;if(!this.hydrator||!this.isConnected)return;let e=null==(t=this.parentElement)?void 0:t.closest("astro-island[ssr]");if(e)return void e.addEventListener("astro:hydrate",this.hydrate,{once:!0});let r,n=this.querySelectorAll("astro-slot"),s={},o=this.querySelectorAll("template[data-astro-template]");for(let t of o){let e=t.closest(this.tagName);null!=e&&e.isSameNode(this)&&(s[t.getAttribute("data-astro-template")||"default"]=t.innerHTML,t.remove())}for(let t of n){let e=t.closest(this.tagName);null!=e&&e.isSameNode(this)&&(s[t.getAttribute("name")||"default"]=t.innerHTML)}try{r=this.hasAttribute("props")?i(JSON.parse(this.getAttribute("props"))):{}}catch(t){let e=this.getAttribute("component-url")||"<unknown>",r=this.getAttribute("component-export");throw r&&(e+=` (export ${r})`),console.error(`[hydrate] Error parsing props for component ${e}`,this.getAttribute("props"),t),t}await this.hydrator(this)(this.Component,r,s,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))})),r(this,"unmount",(()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))}))}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(this.hasAttribute("await-children")&&"interactive"!==document.readyState&&"complete"!==document.readyState){let t=()=>{document.removeEventListener("DOMContentLoaded",t),e.disconnect(),this.childrenConnectedCallback()},e=new MutationObserver((()=>{var e;(null==(e=this.lastChild)?void 0:e.nodeType)===Node.COMMENT_NODE&&"astro:end"===this.lastChild.nodeValue&&(this.lastChild.remove(),t())}));e.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",t)}else this.childrenConnectedCallback()}async childrenConnectedCallback(){let t=this.getAttribute("before-hydration-url");t&&await import(t),this.start()}async start(){let t=JSON.parse(this.getAttribute("opts")),e=this.getAttribute("client");if(void 0!==Astro[e])try{await Astro[e]((async()=>{let t=this.getAttribute("renderer-url"),[e,{default:r}]=await Promise.all([import(this.getAttribute("component-url")),t?import(t):()=>()=>{}]),n=this.getAttribute("component-export")||"default";if(n.includes(".")){this.Component=e;for(let t of n.split("."))this.Component=this.Component[t]}else this.Component=e[n];return this.hydrator=r,this.hydrate}),t,this)}catch(t){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,t)}else window.addEventListener(`astro:${e}`,(()=>this.start()),{once:!0})}attributeChangedCallback(){this.hydrate()}},r(t,"observedAttributes",["props"]),t))}})()</script><astro-island await-children="" client=load component-export=default component-url=/_astro/CodeEmbed.BxoFCdDb.js opts={&quot;name&quot;:&quot;CodeEmbedCodeMirror&quot;,&quot;value&quot;:true} props="{&quot;initialValue&quot;:[0,&quot;let prev, next;\nfunction setup() {\n  createCanvas(200, 200, WEBGL)\n  prev = createFramebuffer({ format: FLOAT });\n  next = createFramebuffer({ format: FLOAT });\n  imageMode(CENTER);\n\n  describe(&#39;a rotating, multicolored circle drawing a drail fading away behind it&#39;);\n}\nfunction draw() {\n  // Swap prev and next\n  [prev, next] = [next, prev];\n  // Clear next and draw a new next frame\n  next.begin();\n  clear();\n  // Slightly rotate and scale the last frame\n  push();\n  rotate(0.01);\n  scale(0.99);\n  image(prev, 0, 0);\n  pop();\n  // Add a sphere on top\n  translate(sin(frameCount*0.1)*50, sin(frameCount*0.11)*50);\n  noStroke();\n  normalMaterial();\n  sphere(25);\n  next.end();\n  background(255);\n  image(next, 0, 0);\n}&quot;],&quot;previewable&quot;:[0,true],&quot;editable&quot;:[0,true]}" renderer-url=/_astro/client.CwpMCSBY.js ssr="" uid=OgCD6><div class=code-placeholder></div></astro-island><div class=callout><h5>Try this!</h5><p>Lots of music player software uses feedback to create audio visualizations. Try using feedback in a sketch that <a href=https://p5js.org/reference/#/p5.Amplitude>reacts to music!</a></p></div><p>Here are some tips that will help as you create more advanced feedback effects.</p><h3 id=fading-with-feedback-use-float-precision>Fading with Feedback: Use <code>FLOAT</code> Precision</h3><p><code>p5.Framebuffer</code>s are especially good for feedback because they can store images as higher precision floating-point numbers, which you can specify with <code>createFramebuffer({ format: FLOAT })</code>. Normally, the red, green, and blue values of colors are stored as integers between 0–255. Each time you draw an image, the colors get rounded into that range. A frame can be drawn and redrawn many times in a feedback sketch. This can accumulate lots of rounding errors, sometimes preventing colors from fully fading out. That problem goes away when you use float precision!</p><h3 id=feedback-in-3d-remember-depth>Feedback in 3D: Remember Depth</h3><p>In the example above, we drew the previous frame into the next frame using <code>image(prev, 0, 0)</code>. This draws a rectangle on the screen, which takes up 3D space. If you then try to draw something further away from the camera, it will not show up, because the rectangle is blocking it.</p><table class=h-1><tbody><tr class="[&>*:not(:first-child)]:max-w-xl [&>*:not(:first-child)]:py-2 [&>*]:align-top [&>*]:m-0"><td class=align-top style=height:100%;margin:0><pre class="github-dark shiki" style=background-color:#24292e;color:#e1e4e8;height:100% tabindex=0><code><span class=line><span style=color:#b392f0>push</span><span style=color:#e1e4e8>();</span></span>
<span class=line><span style=color:#b392f0>translate</span><span style=color:#e1e4e8>(</span><span style=color:#79b8ff>0</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>0</span><span style=color:#e1e4e8>, </span><span style=color:#f97583>-</span><span style=color:#79b8ff>500</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#6a737d>// If the camera is z1 units away and</span></span>
<span class=line><span style=color:#6a737d>// you moved back z2 units, then to appear</span></span>
<span class=line><span style=color:#6a737d>// the same size as if you hadn't moved,</span></span>
<span class=line><span style=color:#6a737d>// scale by (z2 + z1) / z1</span></span>
<span class=line><span style=color:#b392f0>scale</span><span style=color:#e1e4e8>((</span><span style=color:#79b8ff>500</span><span style=color:#f97583> +</span><span style=color:#79b8ff> 800</span><span style=color:#e1e4e8>) </span><span style=color:#f97583>/</span><span style=color:#79b8ff> 800</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#b392f0>image</span><span style=color:#e1e4e8>(prev, </span><span style=color:#79b8ff>0</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>0</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#b392f0>pop</span><span style=color:#e1e4e8>();</span></span>
<span class=line></span>
<span class=line></span></code></pre></td><td><p>One way to make sure everything else you draw goes in front of the rectangle is to draw the rectangle farther back but scaled up so that it appears the same size.</p></td></tr><tr class="[&>*:not(:first-child)]:max-w-xl [&>*:not(:first-child)]:py-2 [&>*]:align-top [&>*]:m-0"><td class=align-top style=height:100%;margin:0><pre class="github-dark shiki" style=background-color:#24292e;color:#e1e4e8;height:100% tabindex=0><code><span class=line><span style=color:#b392f0>image</span><span style=color:#e1e4e8>(prev, </span><span style=color:#79b8ff>0</span><span style=color:#e1e4e8>, </span><span style=color:#79b8ff>0</span><span style=color:#e1e4e8>);</span></span>
<span class=line><span style=color:#b392f0>clearDepth</span><span style=color:#e1e4e8>();</span></span></code></pre></td><td><p>Another way is to call <code>clearDepth()</code> to clear its memory of what depth everything has been drawn at.</p></td></tr></tbody></table><h2 id=sketching-with-depth>Sketching with Depth</h2><p>When you draw to a <code>p5.Framebuffer</code>, you can also record geometry depth in 3D space, stored as a number between 0 and 1. You can read this into a shader by using the <code>depth</code> property of a <code>p5.Framebuffer</code>. Depth information can also be used for debugging, as it gives a quick sense of how far away objects are. In the example below, try clicking and holding on the canvas to visualize the depth values.</p><astro-island await-children="" client=load component-export=default component-url=/_astro/CodeEmbed.BxoFCdDb.js opts={&quot;name&quot;:&quot;CodeEmbedCodeMirror&quot;,&quot;value&quot;:true} props="{&quot;initialValue&quot;:[0,&quot;let layer;\nfunction setup() {\n  createCanvas(200, 200, WEBGL);\n  layer = createFramebuffer();\n\n  describe(&#39;a line of spheres going off into the distance&#39;);\n}\nfunction draw() {\n  noStroke();\n \n  // Draw a scene to a framebuffer\n  layer.begin();\n  background(255)\n  ambientLight(100);\n  directionalLight(255, 255, 255, -1, 1, -1);\n  ambientMaterial(52, 58, 235);\n  fill(255)\n  specularMaterial(255);\n  shininess(150);\n  // Draw some spheres receding into the distance\n  let n = 8;\n  for (let i = 0; i &lt; n; i += 1) {\n    push();\n    translate(\n      map(i, 0, n-1, -100, 750),\n      20,\n      i * -200\n    );\n    sphere(100, 60, 30);\n    pop();\n  }\n  layer.end();\n\n\n  // Visualize either the color or the depth\n  push();\n  if (mouseIsPressed) {\n    texture(layer.depth);\n  } else {\n    texture(layer.color);\n  }\n  plane(width, height);\n  pop();\n}&quot;],&quot;previewable&quot;:[0,true],&quot;editable&quot;:[0,true]}" renderer-url=/_astro/client.CwpMCSBY.js ssr="" uid=Z24OR9r><div class=code-placeholder></div></astro-island><p>Depth information can be useful if you want to change an image based on how far from the camera things are. One common effect that uses this is fog, where objects placed further away are tinted a fog color.</p><p>If you pass both the <code>color</code> and <code>depth</code> properties of a framebuffer into a shader, the original color can be read via <code>texture2D(color, vTexCoord)</code> as a <code>vec4</code>. Using the same coordinate, the depth of that pixel can be read using <code>texture2D(depth, vTexCoord).r</code>, reading just the red channel to get a single <code>float</code>.</p><astro-island await-children="" client=load component-export=default component-url=/_astro/CodeEmbed.BxoFCdDb.js opts={&quot;name&quot;:&quot;CodeEmbedCodeMirror&quot;,&quot;value&quot;:true} props="{&quot;initialValue&quot;:[0,&quot;let vert = `\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec2 vTexCoord;\n\nvoid main() {\n    // Apply the camera transform\n    vec4 viewModelPosition = uModelViewMatrix * vec4(aPosition, 1.0);\n\n    // Tell WebGL where the vertex goes\n    gl_Position = uProjectionMatrix * viewModelPosition;  \n\n    // Pass along data to the fragment shader\n    vTexCoord = aTexCoord;\n}\n`;\n\nlet frag = `\nprecision highp float;\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D img;\nuniform sampler2D depth;\nuniform vec3 fog;\n\nvoid main() {\n  gl_FragColor = mix(\n    // Original color\n    texture2D(img, vTexCoord),\n    // Fog color\n    vec4(178.0/255.0, 189.0/255.0, 207.0/255.0, 1.0),\n    // Mix between them based on the depth.\n    // The pow() makes the light falloff a bit steeper.\n    pow(texture2D(depth, vTexCoord).r, 6.0)\n  );\n}\n`;\nlet layer, fogShader;\nfunction setup() {\n  createCanvas(200, 200, WEBGL);\n  fogShader = createShader(vert, frag);\n  layer = createFramebuffer();\n  noStroke();\n\n  describe(&#39;red spheres circling through fog&#39;);\n}\nfunction draw() {\n  // Draw a scene to a framebuffer\n  layer.begin();\n  clear();\n  lights();\n  fill(&#39;red&#39;);\n  for (let i = 0; i &lt; 12; i++) {\n    push()\n    translate(\n      sin(frameCount*0.050 + i*1)*50,\n      sin(frameCount*0.051 + i*2)*50,\n      sin(frameCount*0.049 + i*3)*175-75\n    );\n    sphere(10);\n    pop();\n  }\n  layer.end();\n  // Apply fog to the scene\n  shader(fogShader);\n  fogShader.setUniform(&#39;img&#39;, layer.color);\n  fogShader.setUniform(&#39;depth&#39;, layer.depth);\n  plane(width, height);\n}&quot;],&quot;previewable&quot;:[0,true],&quot;editable&quot;:[0,true]}" renderer-url=/_astro/client.CwpMCSBY.js ssr="" uid=ZvtqCm><div class=code-placeholder></div></astro-island><p>If you want to customize how close to or far from the camera an object needs to be to get depth values of 0 or 1, specify near and far values in <a href=https://p5js.org/reference/#/p5/perspective><code>perspective()</code></a>.</p><p><em>Depth-based blur shaders are more advanced and are beyond the scope of this tutorial. If you are interested in how they work, you can look at</em> <a href=https://p5js.org/examples/3d-blur-using-framebuffer-depth.html><em>an example of Framebuffer depth blur</em></a><em>.</em></p><div class=callout><h5>Try this!</h5><p>Can you make a moody, rainy scene using a fog shader to add to the atmosphere?</p></div><h2 id=conclusion>Conclusion</h2><p>If you’re sketching in WebGL mode and need to draw to an image, consider using <a href=/reference/en/p5/createFramebuffer><code>createFramebuffer()</code></a> as a way to make your sketch run fast and give everyone the best viewing experience possible.</p><p>We hope the new techniques framebuffers make possible inspire you and that you create art using them!</p><h2 id=glossary>Glossary</h2><h4 id=gpu>GPU</h4><p>The GPU (Graphics Processing Unit) is a piece of hardware that is particularly well suited for performing many calculations in parallel, making it powerful for 3D graphics.</p><h4 id=framebuffer>Framebuffer</h4><p>A surface that can be drawn to, similar to a <code>p5.Graphics</code>, but that lives on the GPU to take advantage of WebGL hardware acceleration.</p><h4 id=depth>Depth</h4><p>A measurement of how far away from the camera a shape is. A framebuffer stores this measurement for every pixel in its image.</p><h4 id=ping-ponging>Ping-Ponging</h4><p>A programming pattern in computer graphics when one needs to draw the next frame while referring to the previous frame. This is done by switching every frame which framebuffer refers to the previous frame, and drawing the next frame to the remaining one.</p><h2>Related examples</h2><ul></ul><h2>Related references</h2><ul></ul></main><div>p5.js site footer goes here</div></body></html>